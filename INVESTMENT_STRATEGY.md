# 투자 전략 가이드

## 📋 목차
- [전략 개요](#전략-개요)
- [종목 선정 전략](#종목-선정-전략)
- [기술적 분석 시스템](#기술적-분석-시스템)
- [매매 신호 체계](#매매-신호-체계)
- [시장 필터링](#시장-필터링)
- [포트폴리오 관리](#포트폴리오-관리)
- [리스크 관리](#리스크-관리)
- [백테스팅 검증](#백테스팅-검증)
- [전략 요약](#전략-요약)

---

## 전략 개요

본 투자 전략은 **모멘텀 투자**와 **기술적 분석**을 결합한 **퀀트 투자 시스템**입니다.

### 🎯 핵심 철학
1. **강한 모멘텀 추종**: 3개월 수익률 기준 상위 종목에 집중 투자
2. **기술적 확인**: 이동평균선으로 추세 검증
3. **엄격한 손절**: 트레일링 스탑으로 손실 최소화
4. **시장 대응**: 약세장에서는 현금 보유로 자본 보존
5. **체계적 실행**: 감정 배제, 규칙 기반 자동화

### 📊 투자 대상
- **대형주 (Large Cap)**: 시가총액 $10B - $200B
- **초대형주 (Mega Cap)**: 시가총액 $200B 이상
- **선정 기준**: 3개월 수익률 상위 종목
- **포트폴리오 규모**: 총 10개 종목 (각 카테고리 5개씩)

---

## 종목 선정 전략

### 1. 데이터 소스
- **Finviz 스크리너**: 실시간 종목 스크리닝
- **필터 조건**:
  - Market Cap: Large (cap_large) 또는 Mega (cap_mega)
  - 정렬: 3개월 수익률 (Perf Quart) 내림차순

### 2. 선정 프로세스

```
Step 1: Finviz 스크리닝
  ↓
  - 대형주 스크리너: 3개월 수익률 상위 정렬
  - 초대형주 스크리너: 3개월 수익률 상위 정렬
  
Step 2: 상위 5개 추출
  ↓
  - 대형주 Top 5
  - 초대형주 Top 5
  
Step 3: 기술적 분석 수행
  ↓
  - 이동평균선 분석 (MA20, MA60, MA120)
  - 신고가 돌파 여부 확인
  
Step 4: 매매 신호 생성
  ↓
  - 매수/보유/매도 신호 결정
  
Step 5: 포트폴리오 구성
  ↓
  - 10개 종목 동일 가중 (각 10%)
```

### 3. 선정 이유
- **모멘텀 효과**: 최근 강한 성과를 보인 종목은 단기적으로 지속될 가능성이 높음
- **유동성 확보**: 대형주/초대형주는 충분한 거래량으로 슬리피지 최소화
- **리스크 분산**: 두 카테고리로 분산하여 변동성 완화

---

## 기술적 분석 시스템

### 1. 이동평균선 (Moving Average)

#### 사용하는 이동평균선
- **MA20 (20일 이동평균선)**: 단기 추세 파악
- **MA60 (60일 이동평균선)**: 중기 추세 파악
- **MA120 (120일 이동평균선)**: 장기 추세 파악

#### 분석 조건
```
✅ 강세 조건 (모든 조건 만족):
  1. 현재가 > MA60
  2. 현재가 > MA120
  3. MA60 > MA120
  
⚠️ 부분 만족:
  - 위 조건 중 1-2개만 만족
  
❌ 약세:
  - 조건 미충족
```

#### 조건의 의미
- **현재가 > MA60 > MA120**: 단기, 중기, 장기 모두 상승 추세
- **정배열 상태**: 강한 상승 모멘텀 유지 중
- **지지선 역할**: MA60과 MA120이 하락 시 지지선으로 작용

### 2. 신고가 돌파 분석

#### 신고가 정의
- **3개월 최고가**: 최근 60거래일 중 가장 높은 가격
- **돌파 조건**: 전날까지의 최고가를 현재가가 상회

#### 돌파의 의미
```
신고가 돌파 = 강한 상승 모멘텀
  ↓
  - 저항선 돌파 → 새로운 상승 국면 진입
  - 매수 심리 강화 → 추가 상승 가능성 높음
  - 기관 투자자 유입 가능성
```

#### 계산 방식
```python
전 최고가 = 최근 60일 중 최고가 (오늘 제외)
돌파율 = (현재가 - 전 최고가) / 전 최고가 × 100

예시:
  전 최고가: $100
  현재가: $102
  → 돌파율: +2.0% 🚀 매수 신호!
```

### 3. 변동성 분석 (ATR)

#### ATR (Average True Range)
- **기간**: 14일
- **용도**: 트레일링 스탑 버퍼 계산
- **의미**: 종목의 일평균 변동폭

#### ATR 활용
```
ATR 기반 버퍼 = max(1%, 0.5 × ATR%)

높은 변동성 종목 (ATR 4%):
  → 버퍼 2% (= 0.5 × 4%)
  
낮은 변동성 종목 (ATR 1%):
  → 버퍼 1% (최소값)
```

---

## 매매 신호 체계

### 1. 매수 신호 🟢

#### 조건 1: 신고가 돌파 매수
```
✅ 3개월 신고가 돌파
✅ 기술적 조건 만족 (현재가 > MA60 > MA120)
  ↓
🟢 매수 신호
```

**신호 의미**: 강한 상승 모멘텀 + 기술적 뒷받침 → 높은 승률 기대

#### 조건 2: 보유 신호
```
✅ 기술적 조건 만족
❌ 신고가 아님
  ↓
🟢 보유 신호
```

**신호 의미**: 안정적인 상승 추세 유지 중 → 보유 유지

### 2. 매도 신호 🔴

#### 조건 1: 트레일링 스탑 (우선순위 높음)
```
트레일링 스탑 발동 조건:
  1. 현재가 < MA20 - 버퍼 (2일 연속)
  2. MA20 기울기 ≤ 0 (하락 추세)
  ↓
🔴 즉시 매도
```

**버퍼 계산**:
```
버퍼 = max(1%, 0.5 × ATR%)

예시:
  MA20: $100
  버퍼: 1.5%
  → 매도 기준가: $98.50
  
Day 1: 현재가 $98.00 < $98.50 (1일째 이탈)
Day 2: 현재가 $97.50 < $98.50 (2일째 이탈)
  → 🔴 매도 신호 발동!
```

**신호 의미**: 단기 추세 반전 + 하락 가속화 → 손실 최소화

#### 조건 2: MA60 이탈 (손절)
```
전날: 현재가 > MA60 ✅
오늘: 현재가 < MA60 ❌
  ↓
🔴 손절 검토
```

**신호 의미**: 중기 추세 이탈 → 추가 하락 가능성

### 3. 관망 신호 🟡

```
❌ 기술적 조건 미달
  ↓
🟡 관망 (신규 진입 자제)
```

---

## 시장 필터링

### 1. 시장 상태 판단

#### 약세장 (Hold Cash) 조건
```
조건 1: SPY < MA200
  → 장기 추세 이탈 (약세장)

조건 2: SPY < MA120 AND VIX > 20
  → 중기 추세 이탈 + 변동성 과열
```

#### 강세장 (정상 투자) 조건
```
SPY > MA200
AND (SPY > MA120 OR VIX ≤ 20)
  → 정상 투자 진행
```

### 2. 시장 필터 동작

#### 약세장 감지 시
```
1. 새로운 매수 중단
2. 기존 포지션 정리 검토
3. 현금 보유로 자본 보존
4. 시장 회복 대기
```

#### 강세장 확인 시
```
1. 정상적인 매매 신호 실행
2. 포트폴리오 리밸런싱
3. 신고가 돌파 종목 적극 매수
```

### 3. 사용 지표

#### SPY (S&P 500)
- **MA200**: 장기 추세선
- **MA120**: 중기 추세선
- **역할**: 시장 전체 방향성 판단

#### VIX (변동성 지수)
- **임계값**: 20
- **의미**:
  - VIX < 20: 안정적 시장
  - VIX > 20: 공포/불안 시장
- **역할**: 시장 심리 측정

---

## 포트폴리오 관리

### 1. 구성 원칙

#### 종목 구성
```
대형주 (Large Cap) 5종목: 50%
  ├── 종목 A: 10%
  ├── 종목 B: 10%
  ├── 종목 C: 10%
  ├── 종목 D: 10%
  └── 종목 E: 10%

초대형주 (Mega Cap) 5종목: 50%
  ├── 종목 F: 10%
  ├── 종목 G: 10%
  ├── 종목 H: 10%
  ├── 종목 I: 10%
  └── 종목 J: 10%
```

#### 동일 가중 (Equal Weight)
- **각 종목**: 10% 비중
- **이유**: 
  - 단순하고 투명한 전략
  - 소형 종목의 높은 수익률 활용
  - 리밸런싱 효과 극대화

### 2. 리밸런싱 전략

#### 빈도
```
매일 리밸런싱
  ↓
  - 상위 10개 종목 재평가
  - 탈락 종목 매도
  - 신규 진입 종목 매수
  - 각 10% 비중 재조정
```

#### 리밸런싱 효과
```
1. 수익 실현
   - 상승한 종목 일부 매도 (10% 초과분)
   
2. 손실 제한
   - 하락한 종목 비중 축소
   
3. 모멘텀 포착
   - 신규 강세 종목 편입
   
4. 분산 효과
   - 항상 10개 종목 유지
```

### 3. 거래 비용 고려

#### 거래 비용 구성
```
수수료: 0.2%
슬리피지: 0.1%
총 거래 비용: 0.3%

매도 시: -0.3%
매수 시: -0.3%
왕복 비용: -0.6%
```

#### 비용 최적화
```
- 매일 리밸런싱하되 필요한 경우만
- 작은 비중 변화는 무시 (임계값 설정)
- 탈락/진입 종목만 거래
```

---

## 리스크 관리

### 1. 손실 제한 메커니즘

#### 트레일링 스탑
```
목적: 수익 보호 + 손실 최소화
발동: MA20 - 버퍼 2일 연속 이탈
손절폭: 약 -3% ~ -5% (종목별 차이)
```

#### MA60 손절
```
목적: 추세 이탈 시 빠른 대응
발동: MA60 하향 돌파
손절폭: 약 -5% ~ -10%
```

### 2. 포지션 관리

#### 개별 종목 리스크
```
최대 비중: 10% (초과 불가)
  → 단일 종목 폭락 시 최대 손실 10% 제한
```

#### 포트폴리오 리스크
```
총 10개 종목 분산
  → 1-2개 종목 부진해도 나머지 8-9개로 보완
```

### 3. 시장 리스크 대응

#### 약세장 대응
```
SPY < MA200 감지
  ↓
현금 보유 (Hold Cash)
  ↓
자본 보존 (손실 회피)
```

#### 변동성 급등 대응
```
VIX > 20 + SPY < MA120
  ↓
신규 진입 중단
  ↓
기존 포지션 청산 검토
```

---

## 백테스팅 검증

### 1. 기존 백테스팅 (Legacy)

#### 특징
```
- 당일 데이터로 당일 매수/매도
- 거래 비용 미반영
- Look-Ahead Bias 존재
```

#### 한계점
```
❌ 실제 거래 불가능한 가격 사용
❌ 비용 무시로 수익률 과대평가
❌ 실전 적용 시 괴리 발생
```

### 2. 현실적 백테스팅 (Realistic)

#### 개선 사항
```
✅ Look-Ahead Bias 제거
  - 전날 데이터로 종목 선정
  - 당일 시가로 거래 체결

✅ 거래 비용 반영
  - 수수료: 0.2%
  - 슬리피지: 0.1%
  - 총 비용: 0.3% (편도)

✅ 현실적인 체결 가정
  - 시장가 주문 가정
  - 유동성 고려
```

#### 백테스팅 프로세스
```
Day 1 (종목 선정일):
  - 마감 시점 데이터 수집
  - 상위 10개 종목 선정
  
Day 2 (거래 체결일):
  - 시가에 매매 체결
  - 거래 비용 차감
  - 포트폴리오 구성
```

### 3. 성과 지표

#### 수익률 지표
```
- 총 수익률 (Total Return)
- 연환산 수익률 (Annualized Return)
- 월별 수익률 (Monthly Return)
```

#### 리스크 지표
```
- 최대낙폭 (MDD, Maximum Drawdown)
- 표준편차 (Volatility)
- 샤프비율 (Sharpe Ratio) = (수익률 - 무위험수익률) / 표준편차
```

#### 거래 지표
```
- 승률 (Win Rate)
- 평균 수익/손실
- 거래 횟수
- 총 거래 비용
```

### 4. 예상 성과

#### 기존 백테스팅 결과
```
연환산 수익률: 40-60%
MDD: 15-20%
샤프비율: 1.5-2.0
```

#### 현실적 백테스팅 결과
```
연환산 수익률: 25-35% (기존 대비 -30% 감소)
MDD: 15-20% (유사)
샤프비율: 1.0-1.5 (소폭 감소)
```

**결론**: 현실적 백테스팅이 **실제 투자 성과에 더 근접**

---

## 전략 요약

### 🎯 핵심 전략

| 구분 | 내용 |
|------|------|
| **투자 철학** | 모멘텀 투자 + 기술적 분석 |
| **종목 선정** | 대형주/초대형주 3개월 수익률 상위 5개씩 |
| **포트폴리오** | 총 10개 종목, 각 10% 동일 가중 |
| **리밸런싱** | 매일 자동 리밸런싱 |
| **매수 조건** | 신고가 돌파 + MA60 > MA120 정배열 |
| **매도 조건** | 트레일링 스탑 (MA20-버퍼 2일 이탈) 또는 MA60 이탈 |
| **시장 필터** | SPY/VIX 기반 약세장 회피 |
| **리스크 관리** | 개별 종목 10% 제한 + 체계적 손절 |

### 💡 전략의 장점

#### 1. 체계적 실행
```
✅ 감정 배제
✅ 규칙 기반 자동화
✅ 일관된 의사결정
```

#### 2. 리스크 관리
```
✅ 트레일링 스탑으로 손실 제한
✅ 시장 필터로 약세장 회피
✅ 분산 투자로 변동성 완화
```

#### 3. 모멘텀 활용
```
✅ 강한 종목에 집중 투자
✅ 약한 종목 신속 교체
✅ 추세 추종으로 수익 극대화
```

### ⚠️ 전략의 한계

#### 1. 거래 비용
```
매일 리밸런싱 → 잦은 거래 → 높은 비용
  → 실제 수익률 감소 (연 5-10% 영향)
```

#### 2. 슬리피지
```
대량 거래 시 시장 충격
  → 불리한 가격에 체결 가능성
```

#### 3. 시장 환경 의존
```
횡보장/약세장에서는 성과 제한적
  → 강세장에서 최적 성과
```

#### 4. 과거 성과 ≠ 미래 수익
```
백테스팅은 과거 데이터 기반
  → 시장 환경 변화 시 성과 달라질 수 있음
```

### 🚀 적합한 투자자

```
✅ 체계적 투자를 선호하는 투자자
✅ 단기-중기 모멘텀 투자에 관심있는 투자자
✅ 기술적 분석을 신뢰하는 투자자
✅ 자동화 시스템을 활용하려는 투자자
✅ 높은 변동성을 감내할 수 있는 투자자
```

### ❌ 부적합한 투자자

```
❌ 장기 보유를 선호하는 투자자
❌ 낮은 변동성을 원하는 투자자
❌ 거래 비용에 민감한 투자자
❌ 기술적 분석을 신뢰하지 않는 투자자
```

---

## 📚 추가 자료

### 관련 문서
- [README.md](README.md): 시스템 사용법 및 설정
- [DASHBOARD_GUIDE.md](DASHBOARD_GUIDE.md): 대시보드 사용 가이드
- [BACKTEST_IMPROVEMENT.md](BACKTEST_IMPROVEMENT.md): 백테스팅 개선 사항
- [MARKET_FILTER_GUIDE.md](MARKET_FILTER_GUIDE.md): 시장 필터 상세 가이드

### 실행 스크립트
- `main.py`: 일일 종목 분석 및 알림
- `compare_backtests.py`: 기존 vs 현실적 백테스팅 비교
- `run_dashboard.py`: 웹 대시보드 실행

### 테스트
```bash
# Telegram 연결 테스트
python test_telegram.py

# 시장 필터 테스트
python test_market_filter.py

# 백테스팅 비교
python compare_backtests.py
```

---

## 📧 문의 및 지원

이 투자 전략에 대한 질문이나 개선 제안이 있으시면 이슈를 등록해 주세요.

**⚠️ 면책 조항**: 이 전략은 교육 및 연구 목적으로 제공됩니다. 실제 투자 결정은 본인의 판단과 책임 하에 진행하시기 바랍니다.

